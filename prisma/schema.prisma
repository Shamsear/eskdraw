generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tournament {
  id             String       @id @default(uuid())
  name           String
  numPots        Int
  status         String       @default("setup")
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  playersPerTeam Int          @default(4)
  allocations    Allocation[]
  pots           Pot[]
  teams          Team[]

  @@map("tournaments")
}

model Team {
  id           String       @id @default(uuid())
  tournamentId String
  name         String
  logoUrl      String?
  createdAt    DateTime     @default(now())
  allocations  Allocation[]
  tournament   Tournament   @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@map("teams")
}

model Pot {
  id           String       @id @default(uuid())
  tournamentId String
  potNumber    Int
  name         String
  createdAt    DateTime     @default(now())
  allocations  Allocation[]
  players      Player[]
  tournament   Tournament   @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, potNumber])
  @@map("pots")
}

model Player {
  id          String       @id @default(uuid())
  potId       String
  name        String
  createdAt   DateTime     @default(now())
  allocations Allocation[]
  pot         Pot          @relation(fields: [potId], references: [id], onDelete: Cascade)

  @@map("players")
}

model Allocation {
  id           String     @id @default(uuid())
  tournamentId String
  teamId       String
  playerId     String
  potId        String
  createdAt    DateTime   @default(now())
  player       Player     @relation(fields: [playerId], references: [id], onDelete: Cascade)
  pot          Pot        @relation(fields: [potId], references: [id], onDelete: Cascade)
  team         Team       @relation(fields: [teamId], references: [id], onDelete: Cascade)
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@unique([teamId, potId])
  @@map("allocations")
}
